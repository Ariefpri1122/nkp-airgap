{"status":{},"spec":{"name":"APR_Kafka_Rocky","description":"Three node Kafka Cluster. \nRefer to the marketplace description for more information. ","resources":{"service_definition_list":[{"name":"Kafka","description":"","variable_list":[],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"52e204a7_runbook","description":"","task_definition_list":[{"type":"DAG","name":"d6b2bd64_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"d6b2bd64_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"f9b8d70a_runbook","description":"","task_definition_list":[{"type":"DAG","name":"b3bef8fd_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"b3bef8fd_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"ee746a4e_runbook","description":"","task_definition_list":[{"type":"DAG","name":"7d1d386d_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Start kafka","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"Start kafka","description":"","attrs":{"type":"","script":"#!\/bin\/bash\nset -ex\nsudo systemctl start kafka-zookeeper\nsudo systemctl start kafka","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"rocky","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"7d1d386d_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"d5baf4f4_runbook","description":"","task_definition_list":[{"type":"DAG","name":"9200b3da_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"9200b3da_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"5d751ec5_runbook","description":"","task_definition_list":[{"type":"DAG","name":"71400b11_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"71400b11_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""}],"published_service_definition_list":[],"substrate_definition_list":[{"type":"AHV_VM","name":"AHV_Kafka","description":"","variable_list":[],"action_list":[{"type":"fragment","name":"pre_action_create","description":"","runbook":{"name":"07b8878d_runbook","description":"","task_definition_list":[{"type":"DAG","name":"f0649975_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"AHV_Kafka","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"f0649975_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_create","description":"","runbook":{"name":"a98899e9_runbook","description":"","task_definition_list":[{"type":"DAG","name":"4977030d_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"AHV_Kafka","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"4977030d_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"editables":{"readiness_probe":{"connection_type":true,"retries":true,"address":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"categories":true,"name":true,"resources":{"disk_list":{},"memory_size_mib":true,"num_sockets":true,"guest_customization":true,"num_vcpus_per_socket":true,"boot_config":true,"gpu_list":true,"serial_port_list":{},"nic_list":{"0":{"ip_endpoint_list":true,"subnet_reference":true,"vpc_reference":true}}},"cluster_reference":true}},"create_spec":{"type":"","name":"kafka-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"cluster_reference":{"type":"","kind":"cluster","name":"DM3-POC131","uuid":"00064492-be45-a548-596a-7cc25535173d"},"resources":{"type":"","nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"ec41c4f6-f15e-4dc7-85ec-f826397eddea"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[],"network_function_chain_reference":null,"vpc_reference":null}],"power_state":"ON","guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"memory_size_mib":4096,"gpu_list":[],"parent_reference":null,"hardware_clock_timezone":"","account_uuid":"3c60446c-af53-42e4-998b-101987d502ca","guest_customization":{"type":"","cloud_init":{"type":"","meta_data":"","user_data":"#cloud-config\nusers:\n  - name: rocky\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\nchpasswd:\n  list: |\n    rocky:@@{rocky.secret}@@\n  expire: False\nssh_pwauth: true"},"sysprep":null},"boot_config":{"type":"","boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"mac_address":"","boot_type":""},"vtpm_config":null,"disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"AHV_ROCKY_89","uuid":"7507b0d1-1069-4a0b-9556-7e48dc058ac6"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":51200}],"serial_port_list":[]},"categories":{}},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"rocky","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"0","retries":"5","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","disable_readiness_probe":false,"connection_protocol":""}}],"package_definition_list":[{"type":"DEB","name":"AHV_Kafka_Package","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"Kafka","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"da0aa606_runbook","description":"","task_definition_list":[{"type":"DAG","name":"fcf65980_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Kafka Install and Configure","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"AHV_Kafka_Package","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"Kafka Install and Configure","description":"","attrs":{"type":"","script":"#!\/bin\/bash\nset -ex\n\n# -*- Variables and constants\nKAFKA_URL=\"@@{KAFKA_URL}@@\"\nZOOKEEPER_DATA_DIR=\"@@{ZOOKEEPER_DATA_DIR}@@\"\nARRAY_ADDRESS=\"@@{calm_array_address}@@\"\nKAFKA_LOG_DIRS=\"@@{KAFKA_LOG_DIRS}@@\"\nNUMBER_OF_PARTITIONS=\"@@{NUMBER_OF_PARTITIONS}@@\"\n\nID=$((@@{calm_array_index}@@+1))\nfor ip in $(echo \"${ARRAY_ADDRESS}\" | tr \",\" \"\\n\"); do\n  CON+=\"${ip}:2181,\"\ndone\nZOOKEEPER_CONNECT=$(echo $CON | sed  's\/,$\/\/')\n\nsudo dnf -yq update\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/sysconfig\/selinux\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/selinux\/config\nsudo setenforce 0\n# firewalld is enabled by default in Rocky Linux 8. We turn it off for this example\nif (sudo systemctl is-active --quiet firewalld); then\n  echo \"Firewalld is running and needs to up stopped and disabled.\"\n  sudo systemctl stop firewalld\n  sudo systemctl disable firewalld\n  sudo systemctl mask firewalld \nelse\n  echo \"Firewalld is not loaded. Nothing to do\"\nfi\n# -*- Install zookeeper and kafka\nsudo dnf install -yq java-1.8.0-openjdk.x86_64 wget\n\nsudo wget \"${KAFKA_URL}\" -O \/opt\/kafka.tgz\ncd \/opt\/\nsudo chmod a+x kafka.tgz\nsudo mkdir -p kafka\nsudo tar -xzf kafka.tgz -C kafka\/\nsudo mv \/opt\/kafka\/kafka_*\/* \/opt\/kafka\/\n\n# -*- Configure zookeeper and kafka\nsudo echo  \"[Unit]\nDescription=Apache Zookeeper server (Kafka)\nDocumentation=http:\/\/zookeeper.apache.org\nRequires=network.target remote-fs.target\nAfter=network.target remote-fs.target\n\n[Service]\nType=simple\nUser=root\nGroup=root\nEnvironment=JAVA_HOME=\/usr\/lib\/jvm\/jre-1.8.0-openjdk\nExecStart=\/opt\/kafka\/bin\/zookeeper-server-start.sh \/opt\/kafka\/config\/zookeeper.properties\nExecStop=\/opt\/kafka\/bin\/zookeeper-server-stop.sh\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee -a \/etc\/systemd\/system\/kafka-zookeeper.service\n\nsudo echo \"[Unit]\nDescription=Apache Kafka server (broker)\nDocumentation=http:\/\/kafka.apache.org\/documentation.html\nRequires=network.target remote-fs.target\nAfter=network.target remote-fs.target kafka-zookeeper.service\n\n[Service]\nType=simple\nUser=root\nGroup=root\nEnvironment=JAVA_HOME=\/usr\/lib\/jvm\/jre-1.8.0-openjdk\nExecStart=\/opt\/kafka\/bin\/kafka-server-start.sh \/opt\/kafka\/config\/server.properties\nExecStop=\/opt\/kafka\/bin\/kafka-server-stop.sh\" | sudo tee -a \/etc\/systemd\/system\/kafka.service\n\ncount=0\nfor ip in $(echo \"${ARRAY_ADDRESS}\" | tr \",\" \"\\n\"); do\n  count=$((count+1))\n  if [[ \"${ip}\" == \"@@{address}@@\" ]]; then\n  \tip=\"0.0.0.0\"\n  fi\n  echo \"server.${count}=${ip}:2888:3888\" | sudo tee -a \/opt\/kafka\/config\/zookeeper.properties\ndone\n\necho \"initLimit=5\nsyncLimit=2\" | sudo tee -a \/opt\/kafka\/config\/zookeeper.properties\n\nsudo sed -i \"s#dataDir=\\\/tmp\\\/zookeeper#dataDir=${ZOOKEEPER_DATA_DIR}#\" \/opt\/kafka\/config\/zookeeper.properties\nmkdir -p ${ZOOKEEPER_DATA_DIR}\necho ${ID} | sudo tee \"${ZOOKEEPER_DATA_DIR}\/myid\"\nsudo sed -i \"s\/broker.id=0\/broker.id=${ID}\/g\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s\/num.partitions=1\/num.partitions=${NUMBER_OF_PARTITIONS}\/\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s\/zookeeper.connect=localhost:2181\/zookeeper.connect=${ZOOKEEPER_CONNECT}\/\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s#log.dirs=\\\/tmp\\\/kafka-logs#log.dirs=${KAFKA_LOG_DIRS}#g\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s%#listeners=PLAINTEXT:\/\/:9092%listeners=PLAINTEXT:\/\/@@{address}@@:9092%\" \/opt\/kafka\/config\/server.properties\n","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"rocky","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Kafka","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"fcf65980_dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"f813ab0e_runbook","description":"","task_definition_list":[{"type":"DAG","name":"4d590853_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"AHV_Kafka_Package","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"4d590853_dag","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}},{"type":"SUBSTRATE_IMAGE","name":"AHV_ROCKY_89","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[],"version":"","options":{"type":"","name":"AHV_ROCKY_89","resources":{"type":"","image_type":"DISK_IMAGE","checksum":{"type":"","checksum_algorithm":"","checksum_value":""},"source_uri":"https:\/\/download.nutanix.com\/Calm\/AHV_ROCKY_89.qcow2","version":{"type":"","product_version":"8.9","product_name":"Rocky 8"},"architecture":"X86_64"},"description":""}},{"type":"SUBSTRATE_IMAGE","name":"ESX_ROCKY_89","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[],"version":"","options":{"type":"","name":"ESX_ROCKY_89","resources":{"type":"","image_type":"DISK_IMAGE","checksum":{"type":"","checksum_algorithm":"","checksum_value":""},"source_uri":"https:\/\/download.nutanix.com\/Calm\/ESX_ROCKY_89.ova","version":{"type":"","product_version":"8.9","product_name":"Rocky 8"},"architecture":"X86_64"},"description":""}}],"app_profile_list":[{"name":"Nutanix","description":"","variable_list":[{"type":"LOCAL","name":"KAFKA_URL","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"https:\/\/downloads.apache.org\/kafka\/3.7.2\/kafka_2.13-3.7.2.tgz"},{"type":"LOCAL","name":"ZOOKEEPER_DATA_DIR","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"\/home\/rocky\/zookeepeer\/data\/"},{"type":"LOCAL","name":"KAFKA_LOG_DIRS","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"\/var\/log\/kafka-logs"},{"type":"LOCAL","name":"NUMBER_OF_PARTITIONS","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"2"}],"action_list":[],"deployment_create_list":[{"type":"GREENFIELD","name":"15f245d6_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"AHV_Kafka_Package","kind":"app_package"}],"substrate_local_reference":{"name":"AHV_Kafka","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[]}],"credential_definition_list":[{"type":"PASSWORD","name":"rocky","description":"","editables":{"secret":true,"username":true},"username":"rocky","secret":{"attrs":{"secret_reference":{},"is_secret_modified":true},"value":"B54gS117J\/1iKPcSYVBfqfJN9Edw4VofERB1B7rU7MF8PiTAuYbhtQaG:utf-8"},"cred_class":"static"}],"default_credential_local_reference":{"name":"rocky","kind":"app_credential"},"type":"USER","client_attrs":{"d6a38652-8d29-428a-8213-031d4f57ff10":{"y":182,"x":819},"f0cebc24-3cc7-4c47-9c7c-16e40ee4c841":{"y":182,"x":819},"null":{"y":163,"x":543},"fd10377d-642e-4c8a-bd54-143b3e253136":{"y":182,"x":819},"9edf0fe1-9500-49fe-a5fa-f54d88233fcf":{"y":182,"x":819},"15f245d6_deployment":{"y":182,"x":819}}}},"api_version":"3.0","product_version":"4.1.1","metadata":{"last_update_time":"1764510968661033","creation_time":"1764510764946663","spec_version":6,"name":"APR_Kafka_Rocky","kind":"blueprint","categories":{"AppFamily":"BI-Productivity"}},"contains_secrets":true}